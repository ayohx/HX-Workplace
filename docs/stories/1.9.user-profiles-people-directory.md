# Story 1.9: User Profiles and People Directory Enhancement

## Status

**Draft**

---

## Story

**As a** user,  
**I want** comprehensive user profiles with organisational hierarchy and searchable people directory,  
**so that** I can discover colleagues, understand reporting structures, and connect with people.

---

## Acceptance Criteria

1. User profile page displays full user information from database: name, role, department, bio, skills, interests
2. Users can edit their own profiles (bio, profile picture, cover photo, skills, interests)
3. Profile picture and cover photo upload to Supabase Storage with image cropping/resizing
4. Organisational hierarchy visualised on profile page (reporting manager, direct reports)
5. People directory page lists all users with filtering: department, location, role, skills
6. People directory search searches across name, role, department, skills, bio
7. People directory displays user cards with key information (name, role, department, profile picture)
8. Clicking user card navigates to full profile page
9. Profile page shows user's recent posts and activity (last 10 posts)
10. Users can follow/unfollow colleagues to see their updates in personalised feed (future enhancement prep)

### Integration Verification

**IV1:** Existing `ProfilePage` component, navigation, avatar components, profile settings all work correctly  
**IV2:** Profile editing saves to database, image upload resizes correctly, org hierarchy queries efficiently  
**IV3:** Profile page loads <1s, image upload <3s, directory load <1s, search results <300ms

---

## Dev Technical Guidance

### Prerequisites
**Depends on Story 1.1 (Database & Auth), Story 1.2 (Posts) being complete.**

### Database Schema
[Source: supabase/migrations]

**profiles table (already exists, enhance):**
```sql
id, name, avatar, cover_image, role, department, email, bio, location, phone, linkedin, manager_id
skills: text[] -- array of skills
interests: text[] -- array of interests
```

### Key Implementation
- **Image upload**: Use Supabase Storage, resize to 200x200 (avatar), 1200x400 (cover)
- **Org hierarchy**: Recursive query for manager/reports
- **Directory filtering**: Client-side for performance, server-side for large datasets
- **Search**: Full-text search across multiple fields

---

## Tasks / Subtasks

- [ ] **Task 1: Profile Display and Editing** (AC: 1, 2)
  - [ ] Update profile page to load from database
  - [ ] Implement profile edit form with validation
  - [ ] Add skills and interests fields (tag input)
  - [ ] Test: edit profile, verify saves to database

- [ ] **Task 2: Profile Picture and Cover Photo Upload** (AC: 3)
  - [ ] Implement image upload to Supabase Storage (`profiles` bucket)
  - [ ] Add image cropping UI (react-image-crop or similar)
  - [ ] Resize images server-side or client-side before upload
  - [ ] Update profile record with image URLs
  - [ ] Test: upload images, verify resize and display

- [ ] **Task 3: Organisational Hierarchy Display** (AC: 4)
  - [ ] Implement recursive query for manager chain
  - [ ] Implement query for direct reports
  - [ ] Create org chart component (tree view or list)
  - [ ] Test: display manager and reports correctly

- [ ] **Task 4: People Directory** (AC: 5, 6, 7, 8)
  - [ ] Create people directory page
  - [ ] Implement filtering UI (department, location, role, skills)
  - [ ] Implement search across multiple fields
  - [ ] Display user cards in grid layout
  - [ ] Test: filter and search, verify correct results

- [ ] **Task 5: Profile Activity Feed** (AC: 9)
  - [ ] Query user's recent posts (last 10)
  - [ ] Display posts on profile page
  - [ ] Test: verify posts display correctly

- [ ] **Task 6: Follow/Unfollow (Prep for future)** (AC: 10)
  - [ ] Create follows table if not exists
  - [ ] Implement follow/unfollow functions
  - [ ] Add follow button to profile page
  - [ ] Test: follow user, verify database record

- [ ] **Task 7: Integration Testing** (IV1, IV2, IV3)
  - [ ] Performance test: profile page load time
  - [ ] Performance test: image upload and resize
  - [ ] Performance test: directory load and search
  - [ ] Verify navigation and existing components work

---

## Dev Notes

**Key Decisions:**
1. **Image processing**: Resize client-side before upload to save bandwidth
2. **Org hierarchy**: Cache manager/reports data, refresh on profile update
3. **Directory**: Client-side filtering for <1000 users, server-side for larger

**Gotchas:**
- Image upload must validate file type and size before processing
- Org hierarchy must handle circular references (shouldn't exist, but check)
- Directory search should debounce to avoid excessive queries

---

## Dev Agent Record

*To be populated by Dev Agent during implementation*

---

## Change Log

| Date       | Version | Description                          | Author                |
| ---------- | ------- | ------------------------------------ | --------------------- |
| 2025-01-15 | 1.0     | Initial story creation from PRD Epic 1 | Bob (Scrum Master)  |

