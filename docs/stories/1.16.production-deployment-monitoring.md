# Story 1.16: Production Deployment and Monitoring Setup

## Status

**Draft**

---

## Story

**As a** platform owner,  
**I want** production deployment infrastructure with monitoring and analytics,  
**so that** the platform runs reliably, issues are detected quickly, and we understand usage patterns.

---

## Acceptance Criteria

1. Production deployment pipeline configured: automated deployment from main branch to production
2. Environment variables securely managed: production secrets in environment, not in code
3. Database backup strategy: daily automated backups, point-in-time recovery enabled
4. Error tracking integrated: Sentry or similar captures frontend and backend errors with stack traces
5. Performance monitoring: track page load times, API response times, database query performance
6. Analytics integrated: track user activity (page views, feature usage) with privacy-friendly analytics
7. Uptime monitoring: ping service checks site availability every 5 minutes, alerts if down
8. Log aggregation: centralised logging for debugging production issues
9. Deployment rollback procedure: quick rollback if deployment causes issues
10. Production runbook: documentation for common operations (deploy, rollback, scale, troubleshoot)

### Integration Verification

**IV1:** Deployment pipeline triggers on merge to main, builds successfully, deploys to production  
**IV2:** Error tracking captures errors, monitoring dashboards display metrics, logs accessible  
**IV3:** Site uptime >99.9%, error rate <0.1%, deployment time <5 minutes, rollback <2 minutes

---

## Dev Technical Guidance

### Prerequisites
**All features complete (Stories 1.1-1.15) to ensure full production readiness.**

### Deployment Platform Options
[Source: Vite + React app, Supabase backend]

**Recommended: Vercel (frontend) + Supabase (backend)**
- Vercel: automatic deployments, edge network, serverless functions
- Supabase: managed database, auth, storage, backups

**Alternative: Netlify, Cloudflare Pages, AWS Amplify**

### Monitoring Stack
1. **Error Tracking**: Sentry (free tier: 5k events/month)
2. **Analytics**: Plausible or Fathom (privacy-friendly) or Google Analytics
3. **Uptime**: UptimeRobot (free tier: 50 monitors)
4. **Logging**: Supabase logs + Vercel logs

---

## Tasks / Subtasks

- [ ] **Task 1: Production Deployment Pipeline** (AC: 1)
  - [ ] Connect GitHub repository to Vercel
  - [ ] Configure automatic deployment on push to main
  - [ ] Set up preview deployments for pull requests
  - [ ] Test: push to main, verify deployment

- [ ] **Task 2: Environment Variables** (AC: 2)
  - [ ] Move all secrets to Vercel environment variables
  - [ ] Production Supabase keys (different from development)
  - [ ] Sentry DSN, analytics keys
  - [ ] Document required environment variables
  - [ ] Test: deployment uses production env vars

- [ ] **Task 3: Database Backup Strategy** (AC: 3)
  - [ ] Enable Supabase automated daily backups
  - [ ] Enable point-in-time recovery (PITR)
  - [ ] Test: restore from backup, verify data intact
  - [ ] Document backup restoration procedure

- [ ] **Task 4: Error Tracking Integration** (AC: 4)
  - [ ] Create Sentry account and project
  - [ ] Install Sentry SDK: `npm install @sentry/react`
  - [ ] Configure Sentry in `src/main.tsx`
  - [ ] Test: trigger error, verify captured in Sentry

- [ ] **Task 5: Performance Monitoring** (AC: 5)
  - [ ] Integrate Sentry performance monitoring
  - [ ] Track page load times, API calls
  - [ ] Monitor Supabase query performance (slow query log)
  - [ ] Set up performance dashboards
  - [ ] Test: view performance metrics

- [ ] **Task 6: Analytics Integration** (AC: 6)
  - [ ] Choose analytics provider (Plausible, Fathom, or GA)
  - [ ] Add analytics script to `index.html`
  - [ ] Configure event tracking for key actions
  - [ ] Test: trigger events, verify tracked

- [ ] **Task 7: Uptime Monitoring** (AC: 7)
  - [ ] Create UptimeRobot account
  - [ ] Add HTTPS monitor for production URL
  - [ ] Configure alerts (email, SMS, Slack)
  - [ ] Test: receive uptime report

- [ ] **Task 8: Log Aggregation** (AC: 8)
  - [ ] Configure Vercel log streaming (if needed)
  - [ ] Access Supabase logs via dashboard
  - [ ] Set up log retention (30 days minimum)
  - [ ] Test: search logs, filter by error level

- [ ] **Task 9: Rollback Procedure** (AC: 9)
  - [ ] Document rollback steps in Vercel
  - [ ] Test rollback to previous deployment
  - [ ] Ensure database migrations are reversible
  - [ ] Document migration rollback procedure

- [ ] **Task 10: Production Runbook** (AC: 10)
  - [ ] Create `docs/PRODUCTION_RUNBOOK.md`
  - [ ] Document deployment procedure
  - [ ] Document rollback procedure
  - [ ] Document scaling (if needed)
  - [ ] Document troubleshooting common issues
  - [ ] Emergency contact information

- [ ] **Task 11: Integration Testing** (IV1, IV2, IV3)
  - [ ] Test full deployment pipeline end-to-end
  - [ ] Verify error tracking captures errors
  - [ ] Verify monitoring dashboards display metrics
  - [ ] Test rollback procedure
  - [ ] Measure deployment time <5 minutes

---

## Dev Notes

**Key Decisions:**
1. **Vercel + Supabase**: Simplest production setup for this stack
2. **Sentry**: Industry-standard error tracking with generous free tier
3. **Privacy-friendly analytics**: Consider Plausible or Fathom for GDPR compliance

**Gotchas:**
- Production Supabase credentials MUST be different from development
- Database migrations must be applied before code deployment
- Monitor error rates closely after deployment (first 24 hours critical)

---

## Production Deployment Checklist

Before going live:
- [ ] All stories 1.1-1.15 complete and tested
- [ ] Database migrations applied to production
- [ ] Environment variables configured in Vercel
- [ ] Supabase production project configured
- [ ] Error tracking verified (Sentry)
- [ ] Analytics tracking verified
- [ ] Uptime monitoring configured
- [ ] Backup strategy tested (restore from backup)
- [ ] Load testing completed (simulate 1000 users)
- [ ] Security audit completed (OWASP Top 10)
- [ ] Production runbook reviewed by team
- [ ] Emergency rollback procedure tested

---

## Dev Agent Record

*To be populated by Dev Agent during implementation*

---

## Change Log

| Date       | Version | Description                          | Author                |
| ---------- | ------- | ------------------------------------ | --------------------- |
| 2025-01-15 | 1.0     | Initial story creation from PRD Epic 1 | Bob (Scrum Master)  |

